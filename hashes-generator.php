<?php
/*
 Hash file generator for WordPress Exploit Scanner
 Author: mattyrob
 Author URI: http://subscribe2.wordpress.com/
*/
$version_url = 'https://api.wordpress.org/core/version-check/1.7/';
$checksum_url = 'https://api.wordpress.org/core/checksums/1.0/?version=';
$locale = '&locale=en_US';

$versions = file_get_contents( $version_url );
$versions = json_decode( $versions );

foreach( $versions->offers as $wp_version ) {
	$filename = dirname( __FILE__ ) . '/' . 'hashes-' . $wp_version->version . '.php';
	if ( ! file_exists( $filename ) ) {
		$checksums = file_get_contents( $checksum_url . $wp_version->version . $locale );
		$checksums = json_decode( $checksums, true );
		$hashes = "<?php\n" . '$filehashes = array(' . "\n";
		foreach ( $checksums['checksums'] as $file => $checksum ) {
			if ( ! strstr( $file, 'wp-content' ) ) {
				$hashes .= "\t'" . $file . "' => '" . $checksum . "',\n";
			}
		}
		$hashes .= ");\n";
		file_put_contents( $filename, $hashes );
		echo 'Hash file created for ' . $wp_version->version . "\n";
	}
}
